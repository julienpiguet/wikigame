<!DOCTYPE html>
<html>

<head>
    <title>Wikigame</title>
</head>

<body>
    <form id="create" action="">
        <button>Create</button>
    </form>
    <form id="leave" action="">
        <button>Leave</button>
    </form>
    <form id="start" action="">
        <button>Start</button>
    </form>
    <form id="join" action="">
        <input id="inputJoin" autocomplete="off" /><button>Join</button>
    </form>
    <form id="vote" action="">
        <input id="inputVote" autocomplete="off" /><button>Vote</button>
    </form>
    <ul id="log"></ul>
    <ul id="votes"></ul>
    <ul id="scoreboard"></ul>
    <span id="timer"></span>
</body>
<script src="/socket.io/socket.io.js"></script>
<script>
    var socket = io();


    var create = document.getElementById('create');
    var leave = document.getElementById('leave');
    var start = document.getElementById('start');
    var timer = document.getElementById('timer');
    var join = document.getElementById('join');
    var vote = document.getElementById('vote');
    var votes = document.getElementById('votes');
    var scoreboard = document.getElementById('scoreboard');
    var inputJoin = document.getElementById('inputJoin');
    var inputVote = document.getElementById('inputVote');

    join.addEventListener('submit', function (e) {
        e.preventDefault();
        if (inputJoin.value) {
            socket.emit('join', inputJoin.value);
            inputJoin.value = '';
        }
    });
    create.addEventListener('submit', function (e) {
        e.preventDefault();
        socket.emit('create');
    });
    start.addEventListener('submit', function (e) {
        e.preventDefault();
        socket.emit('start');
    });
    leave.addEventListener('submit', function (e) {
        e.preventDefault();
        socket.emit('leave');
    });
    vote.addEventListener('submit', function (e) {
        e.preventDefault();
        socket.emit('vote', inputVote.value);
        inputVote.value = '';
    });

    var log = document.getElementById('log');
    socket.on('log', function (msg) {
        var item = document.createElement('li');
        item.textContent = msg.message + (msg.data != null ? ' ' + msg.data : '');
        if (msg.id >= 300) item.style.color = "red"
        log.appendChild(item);
    });

    socket.on('timer', (time) => {
        timer.textContent = time.data;
    })

    socket.on('votes', function (msg) {
        votes.innerHTML = "";
        /* str = JSON.stringify(msg);
        console.log(str); */
        msg.data.forEach(element => {
            var item = document.createElement('li');
            item.textContent = element.id + ' ' + element.name + ' ' + element.vote;
            votes.appendChild(item);
        });

    });

    socket.on('scoreboard', function (msg) {
        scoreboard.innerHTML = "";
        /* str = JSON.stringify(msg);
        console.log(str); */
        msg.data.forEach(element => {
            var item = document.createElement('li');
            item.textContent = element.id + ' ' + element.name + ' ' + element.score;
            scoreboard.appendChild(item);
        });

    });
</script>

</html>